services:
  imagetools:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: imagetools
    ports:
      - "8082:8081"  # Using 8082 to avoid conflicts with existing services
    volumes:
      - imagetools-storage:/app/storage
    environment:
      # Server Configuration
      - DEBUG=False
      - LOG_LEVEL=INFO
      - SERVER_HOST=0.0.0.0
      - SERVER_PORT=8081
      
      # Session & Upload Limits
      - SESSION_EXPIRY_DAYS=7
      - MAX_IMAGES_PER_SESSION=5
      - MAX_UPLOAD_SIZE_MB=20
      
      # Security - IMPORTANT: Change this in production!
      - SESSION_SECRET_KEY=${SESSION_SECRET_KEY:-change-this-secret-key-in-production-min-32-chars}
      
      # CORS - Add your deployment URL here
      # For localhost: http://localhost:8082
      # For LAN: http://192.168.1.100:8082 (replace with your server IP)
      # For domain: https://yourdomain.com
      - CORS_ORIGINS=http://localhost:8082,http://127.0.0.1:8082
      
      # Instance URL - Used for mobile/addon enrollments and OAuth callbacks
      # CRITICAL: Set this to your actual deployment URL
      # This is used for:
      #   - Android mobile app QR code enrollment
      #   - Browser addon connection URLs
      #   - OpenRouter OAuth callback URL ({INSTANCE_URL}/oauth/callback)
      # Examples:
      #   Localhost: http://localhost:8082
      #   LAN: http://192.168.1.100:8082 (replace with your server IP)
      #   Domain: https://yourdomain.com
      - INSTANCE_URL=${INSTANCE_URL:-http://localhost:8082}
      
      # OpenRouter Configuration
      - OPENROUTER_APP_NAME=ImageTools
      
      # Optional: Fallback API key (leave empty to require user enrollment)
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY:-}
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8081/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  imagetools-storage:
    driver: local
