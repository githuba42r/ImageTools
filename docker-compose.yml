services:
  imagetools:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: imagetools
    ports:
      - "8082:8081"  # Using 8082 to avoid conflicts with existing services
    volumes:
      - imagetools-storage:/app/storage
    environment:
      - DEBUG=False
      - LOG_LEVEL=INFO
      - SERVER_HOST=0.0.0.0
      - SERVER_PORT=8081
      - SESSION_EXPIRY_DAYS=7
      - MAX_IMAGES_PER_SESSION=5
      - MAX_UPLOAD_SIZE_MB=20
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY:-}
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8081/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  imagetools-storage:
    driver: local
